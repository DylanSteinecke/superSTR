# Outlier (anomaly) detection

23/11: Note: the current outlier.py script only implements the ABC-bootstrapped 95th quantile estimator due to a bug in the install process for the libraries necessary for the other methods. This is being worked on. 

The choice of which methods should be used with superSTR output is dependent on context, but simple implementations of three methods and two built-in metrics are provided in this library along with instructions for implementing your own anomaly detection methods.


## Requirements

The provided outlier detection code requires installation of some python libraries, which I recommend you install using conda (or venv).

```
conda create --name superSTR python=3.7
pip install -U pip
pip install arch
...
conda activate superSTR
```

## Time and resource requirements

Anomaly detection methods may be highly resource-intensive, or produce outputs for very large numbers of motifs. To help with managing this load we provide a set of (optional) flags that allow you to limit the outlier detection process to certain motifs by identity or length. 

They are:

`--pathogenic`

Limits outlier detection to known-pathogenic motifs sourced from Bahlo, M. *et al*, [Recent advances in the detection of repeat expansions with short-read next-generation sequencing](https://f1000research.com/articles/7-736/v1), F1000 Research (2018).

`--max_motif n`

Limits outlier detection to motifs with a motif length <= n.


## Metrics

**Max-length count**

This is simply the (library-size normalised) count of reads which have a repetition running the full length of the read; if the read length is 150nt, this would mean that the entire 150nt sequence is repetitive.

**superSTR summary score**

This score is generated by:

![summary score](info_score.png)

The lower and upper bounds for calculation can be set by the `--min_len` and `--max_len` parameters and will default to 75% of the read length and the read length, respectively.

**Count vector**

Some methods may use the full superSTR library-size normalised read count vector.

## Anomaly detection methods

**ABC bootstrapped 95th quantile estimator**

This method estimates the 95% confidence interval for the metric's 95th (or other) quantile. It uses the ABC bootstrap (Diciccio T, Efron B, [More accurate confidence intervals in exponential families](http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.998.7855&rep=rep1&type=pdf), 1992, Biometrika 79 231â€“245). The ABC bootstrap provides a more-conservative estimate of the 95th quantile than the standard bootstrap given the distributions of summary scores observed in superSTR analysis.

**ABC-bootstrapped 95th quantile estimator on the summary score for known-pathogenic motifs: ** `python outliers.py --input input_dir/ --pathos --bootstrapCI --ci 95 -is
